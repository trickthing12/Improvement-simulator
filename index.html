<!DOCTYPE html>
<html lang="ko">
<head>
    <meta charset="UTF-8">
    <title>ë¼ì´ì¹´ ê°œì„ ì•ˆ ì‹œë®¬ë ˆì´í„°</title>
    <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
    <style>
        :root { --lk-color: #28a745; --dn-color: #dc3545; --gray: #666; --blue: #007bff; }
        body { font-family: 'Pretendard', sans-serif; background: #f0f4f8; padding: 20px; color: #333; }
        .layout { max-width: 1400px; margin: auto; display: flex; flex-direction: column; gap: 20px; }
        .panels { display: grid; grid-template-columns: repeat(3, 1fr); gap: 15px; }
        .card { background: white; padding: 15px; border-radius: 12px; box-shadow: 0 4px 10px rgba(0,0,0,0.1); border-top: 5px solid #ddd; }
        .card h2 { font-size: 1rem; margin-top: 0; padding-bottom: 8px; border-bottom: 1px solid #eee; }
        .input-grid { display: grid; grid-template-columns: 1fr 1fr; gap: 8px; margin-top: 8px; }
        .input-group { display: flex; flex-direction: column; gap: 2px; }
        label { font-size: 0.75rem; font-weight: bold; color: #777; }
        input, select { padding: 6px; border: 1px solid #ddd; border-radius: 5px; font-size: 0.85rem; }
        .timing-input { background: #fffbe6; border-color: #ffe58f; grid-column: 1 / -1; }
        .prop-box { grid-column: 1 / -1; background: #eef9f1; padding: 10px; border-radius: 8px; margin-top: 5px; border: 1px solid #c3e6cb; }
        .chart-container { background: white; padding: 15px; border-radius: 12px; height: 350px; box-shadow: 0 4px 10px rgba(0,0,0,0.1); }
        .comparison-panel { display: grid; grid-template-columns: repeat(2, 1fr); gap: 15px; background: #fff; padding: 20px; border-radius: 12px; box-shadow: 0 4px 10px rgba(0,0,0,0.1); text-align: center; }
        .comp-card { padding: 10px; border-radius: 8px; background: #f9f9f9; border: 1px solid #eee; }
        .comp-value { font-size: 1.8rem; font-weight: 800; }
        .logs-panel { display: grid; grid-template-columns: repeat(3, 1fr); gap: 15px; }
        .log-box { background: #222; color: #0f0; padding: 10px; border-radius: 8px; height: 200px; overflow-y: auto; font-family: monospace; font-size: 0.75rem; white-space: pre-wrap; }
        button { width: 100%; padding: 15px; background: #4a90e2; color: white; border: none; border-radius: 10px; cursor: pointer; font-size: 1.1rem; font-weight: bold; }
    </style>
</head>
<body>

<div class="layout">
    <h1>ë¼ì´ì¹´ ê°œì„ ì•ˆ ì‹œë®¬ë ˆì´í„°</h1>

    <div class="panels">
        <div class="card" style="border-top-color: var(--gray);">
            <h2>ê¸°ë³¸ ë¼ì´ì¹´ (Original)</h2>
            <div class="input-grid">
                <div class="input-group"><label>ê³µê²©ë ¥</label><input type="number" id="lk_orig_atk" value="5000"></div>
                <div class="input-group"><label>ì¹˜í™•/ì¹˜í”¼(%)</label><div style="display:flex;"><input type="number" id="lk_orig_crit" value="30" style="width:50%"><input type="number" id="lk_orig_cd" value="50" style="width:50%"></div></div>
                <div class="input-group"><label>í‰íƒ€/ê°•í™” ê³„ìˆ˜(%)</label><input type="number" id="lk_orig_base_c" value="150"></div>
                <div class="input-group"><label>ì €í•™ë…„ ê³„ìˆ˜(%)</label><input type="number" id="lk_orig_low_c" value="0"></div>
                <div class="input-group"><label>ê³ í•™ë…„ ê³„ìˆ˜(%)</label><input type="number" id="lk_orig_high_c" value="650"></div>
                <div class="input-group"><label>ì–´ì‚¬ì´ë“œ</label><select id="lk_orig_aside"><option value="0">0</option><option value="1">a1</option><option value="2" selected>a2</option><option value="3">a3</option></select></div>
                <div class="input-group timing-input"><label>ì €í•™ë…„/ê³ í•™ë…„ íƒ€ì´ë° (ì´ˆ)</label><input type="text" id="lk_orig_t" value="20, 40 | 30, 32"></div>
            </div>
        </div>

        <div class="card" style="border-top-color: var(--lk-color);">
            <h2>ê°œì„  ë¼ì´ì¹´ (Proposed)</h2>
            <div class="input-grid">
                <div class="input-group"><label>ê³µê²©ë ¥</label><input type="number" id="lk_prop_atk" value="5000"></div>
                <div class="input-group"><label>ì¹˜í™•/ì¹˜í”¼(%)</label><div style="display:flex;"><input type="number" id="lk_prop_crit" value="30" style="width:50%"><input type="number" id="lk_prop_cd" value="50" style="width:50%"></div></div>
                <div class="input-group"><label>í‰íƒ€/ê°•í™” ê³„ìˆ˜(%)</label><input type="number" id="lk_prop_base_c" value="150"></div>
                <div class="input-group"><label>ì €í•™ë…„ ê³„ìˆ˜(%)</label><input type="number" id="lk_prop_low_c" value="0"></div>
                <div class="input-group"><label>ê³ í•™ë…„ ê³„ìˆ˜(%)</label><input type="number" id="lk_prop_high_c" value="650"></div>
                <div class="input-group"><label>ì–´ì‚¬ì´ë“œ</label><select id="lk_prop_aside"><option value="0">0</option><option value="1">a1</option><option value="2" selected>a2</option><option value="3">a3</option></select></div>
                <div class="prop-box"><label>âœ¨ ê°œì„ : í‰íƒ€ì¦í­/ê³µì¦(%)</label><div style="display:flex;gap:5px;"><input type="number" id="p_norm" value="10" style="width:50%"><input type="number" id="p_atk" value="20" style="width:50%"></div></div>
                <div class="input-group timing-input"><label>ì €í•™ë…„/ê³ í•™ë…„ íƒ€ì´ë° (ì´ˆ)</label><input type="text" id="lk_prop_t" value="20, 40 | 30, 32"></div>
            </div>
        </div>

        <div class="card" style="border-top-color: var(--dn-color);">
            <h2>ë””ì•„ë‚˜[ì™•ë…„] (Diana)</h2>
            <div class="input-grid">
                <div class="input-group"><label>ê³µê²©ë ¥</label><input type="number" id="dn_atk" value="5000"></div>
                <div class="input-group"><label>ì¹˜í™•/ì¹˜í”¼(%)</label><div style="display:flex;"><input type="number" id="dn_crit" value="30" style="width:50%"><input type="number" id="dn_cd" value="50" style="width:50%"></div></div>
                <div class="input-group"><label>í‰íƒ€/ê°•í™” ê³„ìˆ˜(%)</label><input type="number" id="dn_base_c" value="90"></div>
                <div class="input-group"><label>ì €í•™ë…„ ê³„ìˆ˜(%)</label><input type="number" id="dn_low_c" value="780"></div>
                <div class="input-group"><label>ê³ í•™ë…„ ê³„ìˆ˜(%)</label><input type="number" id="dn_high_c" value="2350"></div>
                <div class="input-group"><label>ì–´ì‚¬ì´ë“œ</label><select id="dn_aside"><option value="0">0</option><option value="1">a1</option><option value="2" selected>a2</option><option value="3">a3</option></select></div>
                <div class="input-group timing-input" style="margin-top:40px;"><label>ì €í•™ë…„/ê³ í•™ë…„ íƒ€ì´ë° (ì´ˆ)</label><input type="text" id="dn_t" value="20, 40 | 30, 70"></div>
            </div>
        </div>
    </div>

    <button onclick="run()">ì‹œë®¬ë ˆì´ì…˜ ì‹œì‘</button>

    <div class="chart-container"><canvas id="dmgChart"></canvas></div>

    <div class="comparison-panel">
        <div class="comp-card"><div>ê°œì„  íš¨ìœ¨ (ê°œì„  vs ê¸°ì¡´)</div><div id="diff_prop_orig" class="comp-value">0%</div></div>
        <div class="comp-card"><div>ìƒëŒ€ ì„±ëŠ¥ (ê°œì„  vs ë””ì•„ë‚˜[ì™•ë…„])</div><div id="diff_prop_dn" class="comp-value">0%</div></div>
    </div>

    <div class="logs-panel">
        <div><h3>ê¸°ë³¸ ë¡œê·¸</h3><div id="log_orig" class="log-box"></div></div>
        <div><h3>ê°œì„  ë¡œê·¸</h3><div id="log_prop" class="log-box"></div></div>
        <div><h3>ë””ì•„ë‚˜[ì™•ë…„] ë¡œê·¸</h3><div id="log_dn" class="log-box"></div></div>
    </div>
</div>

<script>
let chart;
const get = (id) => document.getElementById(id).value;
const parseT = (id) => {
    const val = get(id);
    if (!val.includes('|')) return { low: [], high: [] };
    const parts = val.split('|');
    return { 
        low: parts[0].split(',').map(v => parseFloat(v.trim())).filter(n => !isNaN(n)).sort((a,b)=>a-b),
        high: parts[1].split(',').map(v => parseFloat(v.trim())).filter(n => !isNaN(n)).sort((a,b)=>a-b)
    };
};

function run() {
    const timeLimit = 100;
    const configs = {
        orig: { atk: parseFloat(get('lk_orig_atk')), crit: parseFloat(get('lk_orig_crit'))/100, cd: parseFloat(get('lk_orig_cd'))/100, baseC: parseFloat(get('lk_orig_base_c'))/100, low: parseFloat(get('lk_orig_low_c'))/100, high: parseFloat(get('lk_orig_high_c'))/100, aside: parseInt(get('lk_orig_aside')), t: parseT('lk_orig_t') },
        prop: { atk: parseFloat(get('lk_prop_atk')), crit: parseFloat(get('lk_prop_crit'))/100, cd: parseFloat(get('lk_prop_cd'))/100, baseC: parseFloat(get('lk_prop_base_c'))/100, low: parseFloat(get('lk_prop_low_c'))/100, high: parseFloat(get('lk_prop_high_c'))/100, aside: parseInt(get('lk_prop_aside')), t: parseT('lk_prop_t'), pNorm: parseFloat(get('p_norm'))/100, pAtk: parseFloat(get('p_atk'))/100 },
        dn: { atk: parseFloat(get('dn_atk')), crit: parseFloat(get('dn_crit'))/100, cd: parseFloat(get('dn_cd'))/100, baseC: parseFloat(get('dn_base_c'))/100, low: parseFloat(get('dn_low_c'))/100, high: parseFloat(get('dn_high_c'))/100, aside: parseInt(get('dn_aside')), t: parseT('dn_t') }
    };

    const rOrig = sim('lk_orig', configs.orig, timeLimit);
    const rProp = sim('lk_prop', configs.prop, timeLimit);
    const rDn = sim('dn', configs.dn, timeLimit);

    document.getElementById('log_orig').innerText = rOrig.log;
    document.getElementById('log_prop').innerText = rProp.log;
    document.getElementById('log_dn').innerText = rDn.log;

    const calc = (target, base) => (((target / base) - 1) * 100).toFixed(1);
    document.getElementById('diff_prop_orig').innerText = "+" + calc(rProp.data.at(-1), rOrig.data.at(-1)) + "%";
    document.getElementById('diff_prop_dn').innerText = calc(rProp.data.at(-1), rDn.data.at(-1)) + "%";

    if(chart) chart.destroy();
    chart = new Chart(document.getElementById('dmgChart').getContext('2d'), {
        type: 'line',
        data: {
            labels: Array.from({length: timeLimit+1}, (_, i) => i + 's'),
            datasets: [
                { label: 'ê¸°ì¡´ ë¼ì´ì¹´', data: rOrig.data, borderColor: '#888', borderWidth: 2, fill: false },
                { label: 'ê°œì„  ë¼ì´ì¹´', data: rProp.data, borderColor: '#28a745', borderWidth: 4, fill: false },
                { label: 'ë””ì•„ë‚˜[ì™•ë…„]', data: rDn.data, borderColor: '#dc3545', borderWidth: 2, fill: false }
            ]
        },
        options: { responsive: true, maintainAspectRatio: false }
    });
}

function sim(type, c, limit) {
    let data = [0], total = 0, t = 0, log = "";
    let isShock = false, isStim = false, isOver = false, isBack = false;
    let atkCD = 0, enhT = 0, lowCD = 0, highCD = 0, hitCount = 0;

    let curAtk = (c.aside >= 1) ? c.atk * 1.06 : c.atk;
    let curCrit = (c.aside >= 1) ? c.crit + 0.06 : c.crit;
    let curCD = (c.aside >= 1) ? c.cd + 0.06 : c.cd;
    const critBonus = (1 + curCrit * curCD);

    while (t < limit) {
        let tAtk = curAtk, aspd = 1.0, dMult = 1.0;

        if (type.includes('lk')) {
            if (isShock && c.aside < 2) aspd *= 0.7;
            if (isOver) aspd *= 1.42;
            if (type === 'lk_prop' && isStim) tAtk *= (1 + c.pAtk);
            if (c.aside >= 3) dMult *= 1.195;
        } else {
            if (isBack && c.aside >= 2) dMult *= 1.6;
            if (c.aside >= 2) dMult *= 1.3;
        }

        // ê³ í•™ë…„ ë°œë™ (ì…ë ¥ëœ c.high ê³„ìˆ˜ ì‚¬ìš©)
        if (c.t.high.length > 0 && t >= c.t.high[0] && highCD <= 0) {
            c.t.high.shift();
            let m = c.high; 
            if (type === 'dn' && c.aside >= 3) m *= 1.33; 
            let d = tAtk * m * dMult * critBonus;
            total += d; highCD = type === 'dn' ? 40 : 32;
            if (type.includes('lk')) isOver = true; else isBack = true;
            log += `[${t.toFixed(1)}s] â˜…ê³ í•™ë…„ (${Math.floor(d)})\n`;
        }

        // ì €í•™ë…„ ë°œë™ (ì…ë ¥ëœ c.low ê³„ìˆ˜ ì‚¬ìš©)
        if (c.t.low.length > 0 && t >= c.t.low[0] && lowCD <= 0) {
            c.t.low.shift();
            if (type.includes('lk')) {
                isShock = true; isStim = true;
                let d = tAtk * c.low * dMult * critBonus; total += d;
                if (type === 'lk_prop' && c.aside >= 2) {
                    let d2 = tAtk * 17.5 * dMult * critBonus; total += d2;
                    highCD = Math.max(0, highCD - 5);
                    log += `[${t.toFixed(1)}s] ì €í•™ë…„ + ë²ˆê°œí€ì¹˜(${Math.floor(d2)})\n`;
                } else log += `[${t.toFixed(1)}s] ì €í•™ë…„ ë°œë™\n`;
            } else {
                let m = c.low; if (c.aside >= 3) m *= 1.33;
                let d = tAtk * m * dMult * critBonus; total += d;
                isBack = false;
                log += `[${t.toFixed(1)}s] ì €í•™ë…„ (ë°±ìˆ˜í•´ì œ) (${Math.floor(d)})\n`;
            }
            lowCD = 15;
        }

        // ë””ì•„ë‚˜ í”¼ê²© ê°•í™” ê³µê²© (1.5ì´ˆë§ˆë‹¤ í”¼ê²© ê°€ì •)
        if (type === 'dn' && Math.floor(t * 10) % 15 === 0) {
            hitCount++;
            if (hitCount >= 12) {
                let d = tAtk * 4.8 * dMult * critBonus; total += d; hitCount = 0;
                log += `[${t.toFixed(1)}s] ğŸ›¡ï¸ê°•í™”ê³µê²©(í”¼ê²©12) (${Math.floor(d)})\n`;
            }
        }

        // í‰íƒ€/ê°•í™” ê³µê²© (ì…ë ¥ëœ c.baseC ê³„ìˆ˜ ì‚¬ìš©)
        if (atkCD <= 0) {
            let m = 0;
            if (type.includes('lk')) {
                if (enhT <= 0) { 
                    m = c.baseC * (isShock ? 2.0 : 1.0); // 150% ë² ì´ìŠ¤, ê°ì „ ì‹œ 2ë°°
                    enhT = 5; log += `[${t.toFixed(1)}s] ê°•í™”ê³µê²©\n`;
                } else m = c.baseC; 
                if (type === 'lk_prop' && isStim) m *= (1 + c.pNorm);
            } else {
                // ë””ì•„ë‚˜ ë°±ìˆ˜ê³µê¶Œ 4ë°°(360%) + ì¶”ê°€ í”¼í•´ 90%
                m = (isBack ? (c.baseC * 4 + 0.9) : c.baseC); 
                if (c.aside >= 2) m += 3.0;
            }
            total += tAtk * m * dMult * critBonus;
            atkCD = 1.0 / aspd;
        }
        if (Math.floor(t*10) % 10 === 0) data.push(Math.floor(total));
        t += 0.1; atkCD -= 0.1; enhT -= 0.1; lowCD -= 0.1; highCD -= 0.1;
    }
    return { data, log };
}
window.onload = run;
</script>
</body>
</html>
